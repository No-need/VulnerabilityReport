import axios from 'axios';

const ContentTypeEnum = {
    JSON: "application/json;",
    FormData: "multipart/form-data",
    FormUrlEncoded: "application/x-www-form-urlencoded;"
}

function CallAPI(option) {
    //set config
    var url = option.url;
    var method = option.method;
    var data = option.data;
    var isFormData = option.isFormData;
    var success = option.success;
    var error = option.error;
    var $form = option.$form;
    var contentType = option.contentType;


    //set headers
    var headers = {
        "X-Requested-With": "XMLHttpRequest"
    };

    if (contentType === "" || contentType === undefined) {
        headers["Content-Type"] = ContentTypeEnum.FormUrlEncoded;
        contentType = ContentTypeEnum.FormUrlEncoded
    };

    // deprecate
    if (isFormData) {
        headers["Content-Type"] = ContentTypeEnum.FormData;
        contentType = contentType.FormData;
    }

    if ($form && !$form.valid()) {//呼叫 jquery.validate.js 的 valid() function
        return Promise.reject("表單驗證失敗");
    }

    return SendAjax({
        url: url,
        method: method ? method : "post",
        headers: headers,
        contentType: contentType,
        data: data,
    }, success, error);

    function SendAjax(config, success, error) {
        return axios(config).then((res) => {
            if (typeof (success) === "function") {
                try {
                    success(res.data);
                }
                catch (ex) {
                    console.error(ex);
                }
            }
            return res;
        }).catch((errorInfo) => {
            if (typeof (error) === "function") { error(errorInfo); }
            console.log(errorInfo);
            return errorInfo;
        });
    }
}

export default CallAPI 