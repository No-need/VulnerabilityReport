import React, { Component, useState,useEffect } from 'react';
import { Link, useParams, useNavigate } from 'react-router-dom';
import CallAPI from '../Librarys/CallAPI'

function Project() {
    const { id } = useParams();
    const [loading, setLoading] = useState(true);
    const [info, setInfo] = useState({ name: "", desc: "" });
    const isEdit = id != null;
    const navigate = new useNavigate();

    useEffect(() => {
        if (isEdit && loading) {
            GetInfo();
            return;
        } else {
            return;
        }
    });

    function GetInfo() {
        CallAPI({
            url: `report/project/${id}`,
            method: 'GET',
            success: (data) => {
                setLoading(false);
                setInfo({ id: data.id, name: data.name, desc: data.description });
            }
        });
    }

    function Save() {
        CallAPI({
            url: `report/project`,
            method: 'PUT',
            data: {
                ID: id,
                Name: info.name,
                Desc: info.desc
            },
            success: (data) => {
                alert("Save Success");
            }
        });
    }

    function Insert() {
        CallAPI({
            url: `report/project`,
            method: 'POST',
            data: {
                ID: info.id,
                Name: info.name,
                Desc: info.desc
            },
            success: () => {
                alert("Insert Success");
                navigate('/');
            }
        });
    }

    function Delete() {
        CallAPI({
            url: `report/project`,
            method: 'DELETE',
            data: {
                ID: info.id
            },
            success: () => {
                alert("Delete Success");
                navigate('/');
            }
        });
    }

    return (
        <div className="container">
            <form>
                <div className="mb-3">
                    <label htmlFor="ID" className="form-label">ID</label>
                    <input type="text" className="form-control" defaultValue={id} onInput={e => setInfo({ ...info, id: e.target.value })} id="ID" aria-describedby="ID" disabled={isEdit} />
                </div>
                <div className="mb-3">
                    <label htmlFor="Name" className="form-label">Name</label>
                    <input type="text" className="form-control" defaultValue={info.name} id="Name" onInput={e =>setInfo({ ...info, name: e.target.value })} aria-describedby="Name" />
                </div>
                <div className="mb-3">
                    <label htmlFor="Desc" className="form-label">Desc</label>
                    <input type="text" className="form-control" id="Desc" onInput={e => setInfo({ ...info, desc: e.target.value })} defaultValue={info.desc} aria-describedby="Desc" />      
                </div>
                <div className="mb-3">
                    {isEdit
                        ?
                        <div>
                            <button type="button" className="btn btn-primary" onClick={Save}>儲存</button>
                            <button type="button" className="btn btn-danger" onClick={Delete}>刪除</button>
                        </div>
                        : <button type="button" className="btn btn-primary" onClick={Insert}>新增</button>                      
                    }                    
                </div>
            </form>
        </div>
    );
}
export { Project }