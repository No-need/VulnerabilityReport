import React, { Component, useState, useEffect } from 'react';
import { Link, useParams, useNavigate } from 'react-router-dom';
import CallAPI from '../Librarys/CallAPI'
import 'react-toastify/dist/ReactToastify.css';
import { Toast } from '../Librarys/Notify';

function Report(){
    const { id,projectId } = useParams();
    const [loading, setLoading] = useState(true);
    const [info, setInfo] = useState({ id: "", projectId: projectId,date:"",content:"" });
    const isEdit = id != null;
    const navigate = new useNavigate();


    useEffect(() => {
        if (isEdit && loading) {
            GetInfo();
            return;
        } else {
            return;
        }
    });

    function GetInfo() {
        CallAPI({
            url: `report/report/${projectId}/${id}`,
            method: 'GET',
            success: (data) => {
                setInfo({ id: data.reportID, projectId: data.projectID, date: data.date, content: data.reportContent });
                setLoading(false);
                console.log(data.date);
            }
        });
    }

    function Save() {
        CallAPI({
            url: `report/report`,
            method: 'PUT',
            data: {
                ReportID: info.id,
                Content: info.content
            },
            success: (data) => {
                setLoading(false);
                Toast.success("Save Success");
            }
        });
    }
    function Insert() {
        CallAPI({
            url: `report/report`,
            method: 'POST',
            data: {
                ProjectID: info.projectId,
                Date: info.date,
                Content: info.content
            },
            success: () => {
                alert("Insert Success");
                navigate('/reporthistory/' + info.projectId );
            }
        });
    }

    function Delete() {
        CallAPI({
            url: `report/report`,
            method: 'DELETE',
            data: {
                ReportID: info.id
            },
            success: () => {
                alert("Delete Success");
                navigate('/reporthistory/' + info.projectId);
            }
        });
    }

    return (
        <>
            <h1>{info.name}</h1>
            <div className="mb-3">
                <label htmlFor="Date" className="form-label">Date</label>
                <input type="date" className="form-control" value={info.date} onInput={e => setInfo({ ...info, date: e.target.value })} id="Date" aria-describedby="Date" disabled={isEdit} />
            </div>
            <div className="mb-3">
                <label htmlFor="Content" className="form-label">Content</label>
                <textarea type="text" rows={25} className="form-control" id="Content" onInput={e => setInfo({ ...info, content: e.target.value })} value={info.content} aria-describedby="Content" />
            </div>
            <div className="mb-3">
                {isEdit
                    ?
                    <>
                        <button type="button" className="btn btn-success" onClick={Save}>save</button>
                        <button type="button" className="btn btn-danger" onClick={Delete}>delete</button>
                    </>
                    : <button type="button" className="btn btn-success" onClick={Insert}>create</button>
                }
                <button type="button" className="btn btn-primary" onClick={() => { navigate(-1) } }>back</button>
            </div>
        </>
    );
}

export {Report}